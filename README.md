# Axion

P2P型のファイル同期ツールです。複数のマシン間でフォルダを自動的に同期します。

## 機能

- リアルタイムファイル監視と自動同期
- P2Pアーキテクチャ（中央サーバー不要）
- 双方向同期
- ファイル変更の検出（SHA256ハッシュベース）
- 自動再接続機能
- 無視パターンの設定

## インストール

```bash
go install github.com/HMasataka/axion/cmd/axion@latest
```

## 使い方

### 初期設定

設定ファイルを作成します：

```bash
axion -init
```

設定ファイルは `~/.config/axion/config.json` に作成されます。

### 設定ファイルの例

```json
{
  "sync_path": "/Users/username/Sync",
  "listen_addr": ":8765",
  "peer_addrs": ["192.168.1.10:8765", "192.168.1.11:8765"],
  "ignore_list": [".git", ".DS_Store", "Thumbs.db", "*.tmp", "*.swp", "*~"]
}
```

### 実行

設定ファイルを使用して実行：

```bash
axion
```

コマンドラインオプションで設定を上書き：

```bash
axion -path /path/to/sync -listen :8765 -peers 192.168.1.10:8765,192.168.1.11:8765
```

### コマンドラインオプション

| オプション | 説明                             |
| ---------- | -------------------------------- |
| `-path`    | 同期するフォルダのパス           |
| `-listen`  | 待ち受けアドレス（例：`:8765`）  |
| `-peers`   | ピアアドレスのカンマ区切りリスト |
| `-config`  | 設定ファイルのパス               |
| `-init`    | デフォルト設定ファイルを作成     |
| `-status`  | 現在のステータスを表示して終了   |

## アーキテクチャ

```
┌─────────────┐     P2P通信      ┌─────────────┐
│   Node A    │◄───────────────►│   Node B    │
│             │                  │             │
│ ┌─────────┐ │                  │ ┌─────────┐ │
│ │ Watcher │ │                  │ │ Watcher │ │
│ └────┬────┘ │                  │ └────┬────┘ │
│      ▼      │                  │      ▼      │
│ ┌─────────┐ │                  │ ┌─────────┐ │
│ │ Syncer  │ │                  │ │ Syncer  │ │
│ └────┬────┘ │                  │ └────┬────┘ │
│      ▼      │                  │      ▼      │
│ ┌─────────┐ │                  │ ┌─────────┐ │
│ │  Peer   │ │                  │ │  Peer   │ │
│ └─────────┘ │                  │ └─────────┘ │
└─────────────┘                  └─────────────┘
```

### コンポーネント

- **Watcher**: ファイルシステムの変更を監視（fsnotify使用）
- **Syncer**: 同期ロジックを管理
- **Peer**: P2P通信を処理
- **Protocol**: メッセージのシリアライズ/デシリアライズ

## プロトコル

TCPベースのカスタムプロトコルを使用します。

### メッセージタイプ

| タイプ          | 説明               |
| --------------- | ------------------ |
| `FILE_CHANGE`   | ファイル変更通知   |
| `FILE_REQUEST`  | ファイルデータ要求 |
| `FILE_DATA`     | ファイルデータ転送 |
| `FILE_DELETE`   | ファイル削除通知   |
| `SYNC_REQUEST`  | 初期同期要求       |
| `SYNC_RESPONSE` | 同期応答           |
